#
# rman_backup.conf - Configuration file for RMAN backup script
# Version: 1.0
# Description: Environment-specific configuration settings
#
# IMPORTANT: This file is sourced by rman_backup.sh - use shell variable syntax
# All paths should be absolute and accessible by the Oracle user
#

# ==============================================================================
# BASE DIRECTORIES
# ==============================================================================

# Base directory for all RMAN backups
# Ensure this filesystem has sufficient space for your backup requirements
BASE_DIR="/backup/rman"

# Specific backup directories (will be created if they don't exist)
# These default to subdirectories under BASE_DIR but can be overridden
BACKUP_L0_DIR="${BASE_DIR}/L0"          # Level 0 (full) backups
BACKUP_L1_DIR="${BASE_DIR}/L1"          # Level 1 (incremental) backups  
BACKUP_ARCH_DIR="${BASE_DIR}/Arch"      # Archive log backups

# ==============================================================================
# BACKUP FORMATS
# ==============================================================================

# Backup file naming formats using date patterns
# These create date-based subdirectories for organization
# Format: backup_type_database_timestamp_sequence_piece.bkp
BACKUP_FORMAT_L0="L0_%d_%T_%s_%p.bkp"
BACKUP_FORMAT_L1="L1_%d_%T_%s_%p.bkp"  
BACKUP_FORMAT_ARCH="arch_%d_%T_%s_%p.bkp"

# ==============================================================================
# RMAN CHANNEL CONFIGURATION
# ==============================================================================

# Number of parallel channels for backup operations
# More channels = faster backup but higher I/O load
# Recommended: 2-4 channels for most environments
CHANNELS=3

# Maximum size per backup piece
# Prevents individual backup files from becoming too large
# Supports K, M, G suffixes (e.g., 500M, 2G, 100G)
CHANNEL_MAXSIZE="2G"

# ==============================================================================
# ORACLE ENVIRONMENT
# ==============================================================================

# Path to oratab file for environment discovery
# Standard locations: /etc/oratab (Linux) or /var/opt/oracle/oratab (Solaris)
ORATAB_PATH="/etc/oratab"

# Override RMAN binary path if needed (optional)
# If not set, will use $ORACLE_HOME/bin/rman
# RMAN_BINARY="/opt/oracle/product/19.0.0/dbhome_1/bin/rman"

# ==============================================================================
# RETENTION AND CLEANUP
# ==============================================================================

# Backup retention period in days
# Backups older than this will be marked obsolete and deleted
RETENTION_DAYS=7

# Retention method: RECOVERY_WINDOW or REDUNDANCY
# RECOVERY_WINDOW: Keep backups for N days
# REDUNDANCY: Keep N copies of each backup
RETENTION_METHOD="RECOVERY_WINDOW"

# Log file retention in days
# Script log files older than this will be deleted
LOG_RETENTION_DAYS=30

# ==============================================================================
# LOGGING DIRECTORIES
# ==============================================================================

# Directory for backup log files
# Main RMAN output will be written here
LOG_DIR="/backup/logs"

# Directory for error log files  
# Parsed error messages and remediation suggestions
ERROR_LOG_DIR="/backup/logs/errors"

# Temporary directory for RMAN scripts and working files
# Should be on fast storage (local disk preferred)
TMP_DIR="/tmp/rman"

# ==============================================================================
# COMPRESSION SETTINGS
# ==============================================================================

# Default compression algorithm when compression is enabled
# Options: BASIC, LOW, MEDIUM, HIGH
# MEDIUM provides good balance of compression ratio and CPU usage
COMPRESSION_ALGORITHM="MEDIUM"

# ==============================================================================
# NOTIFICATION SETTINGS (for future enhancement)
# ==============================================================================

# Email notification settings (not implemented in current version)
# NOTIFICATION_EMAIL="dba@company.com"
# SMTP_SERVER="mail.company.com"

# ==============================================================================
# ADVANCED SETTINGS
# ==============================================================================

# Maximum open files for RMAN
# Increase if you have many datafiles
# MAXOPENFILES=8

# Block change tracking (if enabled)
# Improves incremental backup performance
# BCT_ENABLE="Y"

# Archivelog deletion policy
# DELETE_ARCHIVELOG_AFTER_BACKUP="Y"

# Controlfile autobackup
# Automatically backup controlfile after each backup
CONTROLFILE_AUTOBACKUP="ON"

# Optimize for null compression
# Skip backing up never-used blocks
OPTIMIZE_NULL="Y"

# ==============================================================================
# SECURITY SETTINGS
# ==============================================================================

# Oracle Wallet location for RMAN connections (optional)
# If using wallet authentication instead of OS authentication
# WALLET_LOCATION="/opt/oracle/admin/wallet"

# RMAN encryption settings (optional)
# ENCRYPTION_ALGORITHM="AES256"
# ENCRYPTION_MODE="TRANSPARENT"

# ==============================================================================
# MONITORING AND ALERTING
# ==============================================================================

# Backup validation settings
# VALIDATE_BACKUPS="Y"  # Run backup validation after completion
# CROSSCHECK_FREQUENCY="DAILY"  # How often to crosscheck backups

# Performance monitoring
# SHOW_PROGRESS="Y"  # Display backup progress
# BACKUP_DURATION_WARN_THRESHOLD=240  # Warn if backup takes more than N minutes

# ==============================================================================
# ENVIRONMENT-SPECIFIC CUSTOMIZATIONS
# ==============================================================================

# Site-specific variables can be added here
# Examples:
# SITE_CODE="PROD01"
# BACKUP_SERVER="backup-srv-01"
# SLA_BACKUP_WINDOW="6"  # hours

# ==============================================================================
# ERROR MAPPING CUSTOMIZATION
# ==============================================================================

# Path to external error mapping file (optional)
# If not set, built-in error mapping will be used
# ERROR_MAP_FILE="/opt/oracle/scripts/rman_error_map.txt"

# Error notification threshold
# Send alerts only for these error types: FATAL, ERROR, WARN
ERROR_NOTIFICATION_LEVEL="ERROR"

# ==============================================================================
# END OF CONFIGURATION
# ==============================================================================

# NOTES FOR CUSTOMIZATION:
# 1. Adjust BASE_DIR to your backup filesystem mount point
# 2. Set CHANNELS based on your I/O subsystem capacity
# 3. Configure RETENTION_DAYS according to your backup policy
# 4. Ensure all directories are writable by the Oracle user
# 5. Test configuration with dry-run mode before production use
# 6. Monitor initial backup performance and adjust CHANNELS/CHANNEL_MAXSIZE
# 7. Review error logs regularly and update error mapping as needed

# DISK SPACE PLANNING:
# - Level 0 backup: ~70% of total database size (with compression)
# - Level 1 backup: ~10-30% of Level 0 size (depending on change rate)
# - Archive logs: varies by transaction volume and backup frequency
# - Plan for 3-7 days of retention = multiply above by retention period