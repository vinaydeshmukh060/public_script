# RMAN Backup Configuration File - Version 1.4
# File: rman_backup.conf
# Updates:
# - Added backup_optimization parameter
# - Enhanced for instance and role checks
#
# Base backup directory
base_dir="/backup/rman"

# Date token for subdirectories (YYYY-MM-DD)
backup_date="$(date '+%Y-%m-%d')"

# Backup destination roots (script will append $backup_date)
backup_L0_dir="${base_dir}/L0"
backup_L1_dir="${base_dir}/L1"
backup_Arch_dir="${base_dir}/Arch"

# RMAN executable (path or 'rman')
rman_binary="rman"

# Parallel channels and piece size
channels=3
channel_max_size="4G"

# Oratab path for ORACLE_HOME discovery
oratab_path="/etc/oratab"

################################################################################
# BACKUP BEHAVIOR
################################################################################

# Default compression setting (Y/N) - can be overridden by -c parameter
default_compression="N"

# Backup optimization (Y/N) - skip backing up identical files
backup_optimization="Y"

# Retention policy (days)
retention_days=7

# Logs directory
logs_dir="${base_dir}/logs"

################################################################################
# ARCHIVE LOG SETTINGS
################################################################################

# Archive log behavior
delete_archived_logs="Y"
archive_lag_minutes=15
archive_backup_method="1 TIMES"

################################################################################
# ENVIRONMENT SETTINGS
################################################################################

# Environment profile to source (optional)
environment_profile="oracle"

################################################################################
# LOG RETENTION SETTINGS
################################################################################

# Log retention settings
gzip_after_days=30
remove_zipped_after_days=45

################################################################################
# INTEGRATED ERROR MAPPING (Optional - for enhanced error reporting)
################################################################################

# Define error mappings function (optional)
# Uncomment and customize as needed
define_error_mappings() {
    cat << 'EOF'
ORA-00001|Unique constraint violated|Check for duplicate data insertion and resolve conflicts
ORA-00017|Session requested to set trace event|Review trace event settings and permissions
ORA-00018|Maximum number of sessions exceeded|Increase sessions parameter or check for session leaks
ORA-00020|Maximum number of processes exceeded|Increase processes parameter or check for hung processes
ORA-00028|Your session has been killed|Session was terminated - check for blocking sessions or errors
ORA-00054|Resource busy and acquire with NOWAIT specified|Resource is locked - retry operation or check for blocking sessions
ORA-00060|Deadlock detected while waiting for resource|Resolve deadlock by reviewing and optimizing transaction logic
ORA-00942|Table or view does not exist|Verify object name and schema permissions
ORA-00955|Name is already used by an existing object|Choose a different object name or drop existing object
ORA-01001|Invalid cursor|Check cursor operations and ensure proper cursor handling
ORA-01017|Invalid username/password|Verify database credentials and account status
ORA-01031|Insufficient privileges|Grant necessary privileges to user or role
ORA-01033|Oracle initialization or shutdown in progress|Wait for database startup/shutdown to complete
ORA-01034|Oracle not available|Database is not started - start the instance and database
ORA-01040|Invalid character in password|Use valid characters in password (alphanumeric and special chars)
ORA-01045|User lacks CREATE SESSION privilege|Grant CREATE SESSION privilege to user
ORA-01114|IO error writing block to file|Check disk space, file permissions, and hardware issues
ORA-01116|Error in opening database file|Check file existence, permissions, and disk space
ORA-01555|Snapshot too old|Increase undo tablespace size or undo retention
ORA-01562|Failed to extend rollback segment|Add space to undo tablespace or increase datafile size
ORA-01652|Unable to extend temp segment|Add space to temporary tablespace or increase datafile size
ORA-01653|Unable to extend table by in tablespace|Add space to tablespace or increase datafile autoextend
ORA-01654|Unable to extend index by in tablespace|Add space to tablespace or increase datafile autoextend
RMAN-03009|Failure of command on specific channel|Check channel configuration and underlying storage errors
RMAN-06059|Expected backup piece not found|Verify backup location and check for missing backup files
RMAN-06136|ORACLE error from auxiliary database|Check auxiliary database status and configuration
RMAN-08120|Warning: archived log not deleted|Check archivelog deletion policy and disk space
RMAN-11003|Failure during parse of SQL statement|Review SQL syntax in RMAN script or configuration
RMAN-20201|Tablespace not found|Verify tablespace name exists in target database
EOF
}

# End of configuration file