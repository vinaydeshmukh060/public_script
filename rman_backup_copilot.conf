# rman_backup.conf - Site-specific configuration for rman_backup.sh
# All variables here are environment/installation specific and user-customizable.
# This file is sourced by rman_backup.sh (POSIX sh-compatible).

#------------------------------------------------------------------------------
# Base backup directories
#------------------------------------------------------------------------------
# BASE_DIR: Root directory for all RMAN backups
BASE_DIR="/backup/rman"

# Individual type-specific directories (defaulted to BASE_DIR/<type>)
BACKUP_L0_DIR="${BASE_DIR}/L0"
BACKUP_L1_DIR="${BASE_DIR}/L1"
BACKUP_ARCH_DIR="${BASE_DIR}/Arch"

#------------------------------------------------------------------------------
# Backup naming formats
# Use date format dd-mon-yyyy. The script uses POSIX `date +%d-%b-%Y` at runtime.
# You can include tokens in the path/filename. %U is RMAN unique identifier.
# The script constructs paths like: <dir>/<DATE_TAG>/{type}_<token>_%U.bkp
#------------------------------------------------------------------------------
BACKUP_FORMAT_L0="$(date +%d-%b-%Y)"
BACKUP_FORMAT_L1="$(date +%d-%b-%Y)"
BACKUP_FORMAT_ARCH="$(date +%d-%b-%Y)"

#------------------------------------------------------------------------------
# Channels and piece size
# CHANNELS: Number of channels to allocate (integer >=1)
# CHANNEL_MAXSIZE: Max piece size per channel (e.g., 50G, 100G)
#------------------------------------------------------------------------------
CHANNELS=3
CHANNEL_MAXSIZE="100G"

#------------------------------------------------------------------------------
# Oratab and binaries
# ORATAB_PATH: Path to oratab used to derive ORACLE_HOME for the given SID
# RMAN_BINARY: Optional override of RMAN binary; default is $ORACLE_HOME/bin/rman
#------------------------------------------------------------------------------
ORATAB_PATH="/etc/oratab"
RMAN_BINARY=""

#------------------------------------------------------------------------------
# Logging and temp
# LOG_DIR: Directory for main logs and retention logs
# ERROR_LOG_DIR: Directory for error scan outputs and retention error logs
# TMP_DIR: Directory for temporary generated RMAN/SQL command files
#------------------------------------------------------------------------------
LOG_DIR="/backup/rman/logs"
ERROR_LOG_DIR="/backup/rman/error_logs"
TMP_DIR="/backup/rman/tmp"

#------------------------------------------------------------------------------
# Behavior toggles
# DRY_RUN: Y to build scripts and logs without executing RMAN
# VERBOSE: Y for more verbose messages (currently informational in logs)
#------------------------------------------------------------------------------
DRY_RUN="N"
VERBOSE="N"

#------------------------------------------------------------------------------
# Retention policy
# RETENTION_DAYS: Days for recovery window
# RETENTION_STRATEGY: "WINDOW" to use CONFIGURE RETENTION POLICY TO RECOVERY WINDOW,
#                     or "REPORT_DELETE" to use explicit REPORT/DELETE with recovery window.
# LOG_RETENTION_DAYS: Optional, delete old .log/.err files older than N days
#------------------------------------------------------------------------------
RETENTION_DAYS=3
RETENTION_STRATEGY="WINDOW"
LOG_RETENTION_DAYS=14

#------------------------------------------------------------------------------
# Error mapping
# ERROR_MAP_FILE: Path to a pipe-delimited mapping file: CODE|SHORT_MESSAGE|REMEDY
# ERROR_MAP_DATA: Embedded default mappings; if ERROR_MAP_FILE does not exist,
#                 the main script will create it with these entries.
#------------------------------------------------------------------------------
ERROR_MAP_FILE="${BASE_DIR}/error_map.txt"
ERROR_MAP_DATA="$(cat <<'EOM'
# CODE|SHORT_MESSAGE|REMEDY
RMAN-03009|failure to allocate channel|Check disk space/permissions and RMAN channel allocation
RMAN-06059|expected archived log not found|Verify archivelog destination and crosscheck; delete expired if needed
RMAN-06025|no backup of archived log found|Ensure archivelogs exist; validate log shipping and archive destination
RMAN-20011|target database incarnation not found|Resync RMAN catalog; check for resetlogs/incarnation changes
RMAN-08512|archived log|Informational; investigate only if accompanied by errors
ORA-19511|error occurred during archiving|Check ARCn process and archive destination availability
ORA-19809|limit exceeded for recovery files|Increase FRA size or purge obsolete; review db_recovery_file_dest_size
ORA-00257|archiver error. connect internal only|Free FRA or archive destination space; resume archiving
ORA-27102|out of memory|Check OS memory limits and SGA/PGA sizing; review HugePages
ORA-01555|snapshot too old|Increase UNDO tablespace and optimize long-running transactions
EOM
)"

#------------------------------------------------------------------------------
# Notes:
# - Add more error codes to ERROR_MAP_FILE in the same format. The backup script
#   will parse RMAN logs to extract codes and attach these mapped messages to
#   the error report (.err).
# - Ensure files/directories above are writable by the OS account running RMAN.
#------------------------------------------------------------------------------
